<!-- eslint-disable @angular-eslint/template/no-autofocus -->
<p-popover #taskAddOp (onHide)="onClose($event)">
  <form [formGroup]="taskForm" novalidate (ngSubmit)="saveTask()" #form>
    <p-card>
      <div class="task-add flex flex-column gap-3">
        <div class="task-add-title">
          <input class="task-title-input font-semibold px-2" pInputText name="title" type="text"
            [placeholder]="'Task title' | transloco" formControlName="title" autocomplete="off" [autofocus]="true"
            [appChangeDateTimeFromText]="currentLanguage" [dateComponent]="taskForm.get('dueDate')"
            [timeComponent]="taskForm.get('dueTime')" pSize="small" (keydown.control.enter)="saveTask()" />
        </div>
        <div class="task-add-description">
          <textarea #description pTextarea [placeholder]="'Description' | transloco" [autoResize]="true" rows="1"
            class="text-sm" formControlName="description" (keydown.control.enter)="saveTask()"></textarea>
        </div>
        <div class="task-add-menu">
          <p-datepicker [showIcon]="true" iconDisplay="input" [showButtonBar]="true" [showTime]="false"
            inputId="task-add-due-date" [placeholder]="'Due date' | transloco" formControlName="dueDate"
            class="task-add-dueDate" dateFormat="dd/mm/yy" (keydown.enter)="saveTask()" />

          <p-datepicker [showIcon]="true" iconDisplay="input" inputId="task-add-due-time" [timeOnly]="true"
            [placeholder]="'Time' | transloco" formControlName="dueTime" class="task-add-dueTime"
            (keydown.enter)="saveTask()">
            <ng-template #inputicon let-clickCallBack="clickCallBack">
              <i class="pi pi-clock" (click)="clickCallBack($event)" (keypress)="clickCallBack($event)"
                aria-hidden="true"></i>
            </ng-template>
          </p-datepicker>

          @if (!this.parent) {
          <p-select [options]="projects" optionLabel="name" optionValue="uuid" formControlName="project_uuid"
            name="project_uuid" [placeholder]="'Project' | transloco" class="task-add-project" />
          }
        </div>
        <div class="task-add-recurring-task align-items-center flex flex-row gap-1">
          <p-select [options]="recurringOptions" formControlName="recurring" name="recurring" class="task-add-recurring"
            inputId="recurring" id="recurring">
            <ng-template #selectedItem let-selectedOption>
              <i class="pi pi-history" style="font-size: calc(var(--p-icon-size) - 30%);"></i>
              <span style="margin-left: 5px;">
                {{ selectedOption }}
              </span>
            </ng-template>
          </p-select>
        </div>

        <p-divider />


        <div class="task-add-attachments">
          <h3 class="text-sm font-medium text-gray-700 mb-2">Anexos</h3>
          <input type="file" class="hidden" multiple="" accept="image/*,.pdf">
          <p-button class="add-attachment-button w-full" (onClick)="addAttachment()">
            <i class="pi pi-paperclip"></i>
            Adicionar imagens ou PDFs
          </p-button>
          <div class="mt-3 gap-2" >
            @let index = 0;
            @let i = 0;
            @for (attachment of attachments;track attachment) {
              <div class="attachment-item-row flex items-center p-2 gap-4">
                <div class="flex-shrink-1 mr-2 align-content-center" >
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="attachment-image-icon"
                    stroke="currentColor"  >
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
                      ></path>
                  </svg>
                </div>
                <div class=""  >
                  <p class="text-sm font-medium text-gray-900">{{ attachment.name }}</p>
                  <!-- <p class="text-xs text-gray-500" >152.0 KB</p> -->
                </div>
                <div class="flex-shrink-1 align-content-center">
                  <p-button class="ml-2 text-gray-400 hover:text-gray-600 " icon="pi pi-times" severity="secondary" (onClick)="removeAttachment(i)">
                  </p-button>
                </div>
              </div>
              @let i = index + 1;
            }
            
          </div>
        </div>
        <!-- <div class="attachments flex flex-column align-items-center">
          <h4>Attachments</h4>
          <ul>
            @let index = 0;
            @let i = 0;
            @for (attachment of attachments;track attachment) {
            <li>
              {{ attachment.name }}
              <button (click)="removeAttachment(i)">Remove</button>
            </li>
            @let i = index + 1;
            }
          </ul>
          <p-button (click)="addAttachment()" [severity]="'secondary'">Add Attachment</p-button>
        </div> -->
        <p-divider />
        <div class="task-add-buttons flex flex-row justify-content-end gap-1">
          <div>
            <p-button [label]="'Cancel' | transloco" (onClick)="clearForm() && taskAddOp.toggle($event) "
              severity="secondary" />
          </div>
          <div>
            <p-button [label]="'Save' | transloco" type="submit" />
          </div>
        </div>
      </div>
    </p-card>
  </form>
</p-popover>
